---
tip: 43
title: Non-Fungible Token Output Type
description: Support for layer 1 native non-fungible tokens
author:
  Philipp Gackstatter (@PhilippGackstatter) <philipp.gackstatter@iota.org>, Roman Overko (@roman1e2f5p8s)
  <roman.overko@iota.org>, Levente Pap (@lzpap) <levente.pap@iota.org>
discussions-to: TODO
status: Draft
type: Standards
layer: Core
created: 2023-05-03
requires: TIP-21, TIP-22, TIP-38, TIP-45 and TIP-47
replaces: TIP-18
---

# Summary

This document defines the NFT output type and transaction validation rules for the IOTA protocol to support Layer 1
native **non-fungible tokens** (unique tokens with attached metadata). It was originally introduced in
[TIP-18](../TIP-0018/tip-0018.md) and the functionality defined in this document is an extension of the NFT Output of
TIP-18.

## Summary of changes compared to TIP-18

- Add `Mana` field.
- Remove `Native Tokens` field. See [TIP-38 (Native Token Migration)](../TIP-0038/tip-0038.md#native-token-migration)
  for migration details.

# Motivation

The aim of this TIP is to define an NFT output type for the use cases of seamless interoperability between layer 1 and
layer 2 tokenization concepts. Such non-fungible tokens on layer 1 can be minted and transferred with zero fees. The
validated issuers of such NFTs are immutably attached to the tokens, making it impossible to counterfeit them.

In combination with the other layer 1 output types, users will be able to interact with smart contracts by posting
requests through the Tangle. Requests can carry commands to smart contracts and can additionally also transfer native
tokens and NFTs.

The proposal in this TIP makes it possible for tokens that originate from layer 2 smart contract chains to also be
wrapped into their layer 1 representation. Smart contract chains may transfer tokens between themselves through this
mechanism, and they can also post requests to other chains.

# Building Blocks

## Data Types & Subschema Notation

Data types and subschemas used throughout this TIP are defined in [TIP-21](../TIP-0021/tip-0021.md).

## Protocol Parameters

Protocol parameters used throughout this TIP are defined in [TIP-49](../TIP-0049/tip-0049.md).

## Transaction Payload

[TIP-45](../TIP-0045/tip-0045.md) is the basis for output validation in this TIP.

# NFT Output

Non-fungible tokens in the ledger are implemented with a special output type, the so-called <i>NFTOutput</i>.

Each NFT output gets assigned a unique identifier `NFT ID` upon creation by the protocol. `NFT ID` is BLAKE2b-256 hash
of the <i>Output ID</i> that created the NFT. The address of the NFT is the concatenation of `NFT Address Type` ||
`NFT ID`.

The NFT may contain immutable metadata set upon creation, and a verified `Issuer`. The output type supports all
non-anchor specific (state controller, governor) unlock conditions and optional features so that the output can be sent
as a request to smart contract chain accounts.

<details>
  <summary>NFT Output</summary>
  <blockquote>Describes an NFT output, a globally unique token with metadata attached.</blockquote>
</details>
<table>
  <tr>
    <td>
      <b>Name</b>
    </td>
    <td>
      <b>Type</b>
    </td>
    <td>
      <b>Description</b>
    </td>
  </tr>
  <tr>
    <td>Output Type</td>
    <td>uint8</td>
    <td>Set to <strong>value 4</strong> to denote an <i>NFT Output</i>.</td>
  </tr>
  <tr>
    <td>Amount</td>
    <td>uint64</td>
    <td>The amount of IOTA coins held by the output.</td>
  </tr>
  <tr>
    <td>Mana</td>
    <td>uint64</td>
    <td>The amount of Stored Mana held by the output.</td>
  </tr>
  <tr>
    <td>NFT ID</td>
    <td>ByteArray[32]</td>
    <td>Unique identifier of the NFT, which is the BLAKE2b-256 hash of the <i>Output ID</i> that created it. <i>NFT Address = NFT Address Type || NFT ID</i>.</td>
  </tr>
  <tr>
    <td>Unlock Conditions Count</td>
    <td>uint8</td>
    <td>The number of unlock conditions following.</td>
  </tr>
  <tr>
    <td valign="top">Unlock Conditions <code>atMostOneOfEach</code></td>
    <td colspan="2">
      <details>
        <summary>Address Unlock Condition</summary>
        <blockquote>Defines the Address that owns this output. It can unlock the output with the proper <i>Unlock</i> in a transaction. Defined in <a href='../TIP-0038/tip-0038.md#address-unlock-condition'>TIP-38 (Address Unlock Condition)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Unlock Condition Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 0</strong> to denote an <i>Address Unlock Condition</i>.</td>
          </tr>
          <tr>
            <td valign="top">Address <code>oneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Ed25519 Address</summary>
                <blockquote>An Address derived from an Ed25519 Public Key. Defined in <a href='../TIP-0038/tip-0038.md#ed25519-address'>TIP-38 (Ed25519 Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Account Address</summary>
                <blockquote>An Address derived from an Account ID which can be unlocked by unlocking the corresponding Account. Defined in <a href='../TIP-0038/tip-0038.md#account-address'>TIP-38 (Account Address)</a>.</blockquote>
              </details>
              <details>
                <summary>NFT Address</summary>
                <blockquote>An Address derived from an NFT ID which can be unlocked by unlocking the corresponding NFT. Defined in <a href='../TIP-0038/tip-0038.md#nft-address'>TIP-38 (NFT Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Anchor Address</summary>
                <blockquote>An Address derived from an Anchor ID which can be unlocked by unlocking the corresponding Anchor. Defined in <a href='../TIP-0038/tip-0038.md#anchor-address'>TIP-38 (Anchor Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Multi Address</summary>
                <blockquote>Defines a Multi Address that consists of addresses with weights and a threshold value. The Multi Address can be unlocked if the cumulative weight of all unlocked addresses is equal to or exceeds the threshold. Defined in <a href='../TIP-0052/tip-0052.md#multi-address'>TIP-52 (Multi Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Restricted Address</summary>
                <blockquote>An address that contains another address and allows for configuring its capabilities. Defined in <a href='../TIP-0050/tip-0050.md#restricted-address'>TIP-50 (Restricted Address)</a>.</blockquote>
              </details>
            </td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Storage Deposit Return Unlock Condition</summary>
        <blockquote>Defines the amount of IOTAs used as storage deposit that have to be returned to <i>Return Address</i>. Defined in <a href='../TIP-0038/tip-0038.md#storage-deposit-return-unlock-condition'>TIP-38 (Storage Deposit Return Unlock Condition)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Unlock Condition Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 1</strong> to denote a <i>Storage Deposit Return Unlock Condition</i>.</td>
          </tr>
          <tr>
            <td valign="top">Return Address <code>oneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Ed25519 Address</summary>
                <blockquote>An Address derived from an Ed25519 Public Key. Defined in <a href='../TIP-0038/tip-0038.md#ed25519-address'>TIP-38 (Ed25519 Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Account Address</summary>
                <blockquote>An Address derived from an Account ID which can be unlocked by unlocking the corresponding Account. Defined in <a href='../TIP-0038/tip-0038.md#account-address'>TIP-38 (Account Address)</a>.</blockquote>
              </details>
              <details>
                <summary>NFT Address</summary>
                <blockquote>An Address derived from an NFT ID which can be unlocked by unlocking the corresponding NFT. Defined in <a href='../TIP-0038/tip-0038.md#nft-address'>TIP-38 (NFT Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Anchor Address</summary>
                <blockquote>An Address derived from an Anchor ID which can be unlocked by unlocking the corresponding Anchor. Defined in <a href='../TIP-0038/tip-0038.md#anchor-address'>TIP-38 (Anchor Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Multi Address</summary>
                <blockquote>Defines a Multi Address that consists of addresses with weights and a threshold value. The Multi Address can be unlocked if the cumulative weight of all unlocked addresses is equal to or exceeds the threshold. Defined in <a href='../TIP-0052/tip-0052.md#multi-address'>TIP-52 (Multi Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Restricted Address</summary>
                <blockquote>An address that contains another address and allows for configuring its capabilities. Defined in <a href='../TIP-0050/tip-0050.md#restricted-address'>TIP-50 (Restricted Address)</a>.</blockquote>
              </details>
            </td>
          </tr>
          <tr>
            <td>Return Amount</td>
            <td>uint64</td>
            <td>Amount of IOTA coins the consuming transaction should deposit to the address defined in <i>Return Address</i>.</td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Timelock Unlock Condition</summary>
        <blockquote>Defines a slot index until which the output can not be unlocked. Defined in <a href='../TIP-0038/tip-0038.md#timelock-unlock-condition'>TIP-38 (Timelock Unlock Condition)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Unlock Condition Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 2</strong> to denote a <i>Timelock Unlock Condition</i>.</td>
          </tr>
          <tr>
            <td>Slot Index</td>
            <td>uint32</td>
            <td>Slot index starting from which the output can be consumed.</td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Expiration Unlock Condition</summary>
        <blockquote>Defines a slot index until which only the <i>Address</i> defined in the <i>Address Unlock Condition</i> is allowed to unlock the output. After the slot index is reached/passed, only the <i>Return Address</i> can unlock it. Defined in <a href='../TIP-0038/tip-0038.md#expiration-unlock-condition'>TIP-38 (Expiration Unlock Condition)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Unlock Condition Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 3</strong> to denote an <i>Expiration Unlock Condition</i>.</td>
          </tr>
          <tr>
            <td valign="top">Return Address <code>oneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Ed25519 Address</summary>
                <blockquote>An Address derived from an Ed25519 Public Key. Defined in <a href='../TIP-0038/tip-0038.md#ed25519-address'>TIP-38 (Ed25519 Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Account Address</summary>
                <blockquote>An Address derived from an Account ID which can be unlocked by unlocking the corresponding Account. Defined in <a href='../TIP-0038/tip-0038.md#account-address'>TIP-38 (Account Address)</a>.</blockquote>
              </details>
              <details>
                <summary>NFT Address</summary>
                <blockquote>An Address derived from an NFT ID which can be unlocked by unlocking the corresponding NFT. Defined in <a href='../TIP-0038/tip-0038.md#nft-address'>TIP-38 (NFT Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Anchor Address</summary>
                <blockquote>An Address derived from an Anchor ID which can be unlocked by unlocking the corresponding Anchor. Defined in <a href='../TIP-0038/tip-0038.md#anchor-address'>TIP-38 (Anchor Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Multi Address</summary>
                <blockquote>Defines a Multi Address that consists of addresses with weights and a threshold value. The Multi Address can be unlocked if the cumulative weight of all unlocked addresses is equal to or exceeds the threshold. Defined in <a href='../TIP-0052/tip-0052.md#multi-address'>TIP-52 (Multi Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Restricted Address</summary>
                <blockquote>An address that contains another address and allows for configuring its capabilities. Defined in <a href='../TIP-0050/tip-0050.md#restricted-address'>TIP-50 (Restricted Address)</a>.</blockquote>
              </details>
            </td>
          </tr>
          <tr>
            <td>Slot Index</td>
            <td>uint32</td>
            <td>Before this slot index, <i>Address Unlock Condition</i> is allowed to unlock the output, after that only the address defined in <i>Return Address</i>.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
    <td>Features Count</td>
    <td>uint8</td>
    <td>The number of features following.</td>
  </tr>
  <tr>
    <td valign="top">Features <code>atMostOneOfEach</code></td>
    <td colspan="2">
      <details>
        <summary>Sender Feature</summary>
        <blockquote>Identifies the validated sender of the output. Defined in <a href='../TIP-0038/tip-0038.md#sender-feature'>TIP-38 (Sender Feature)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Feature Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 0</strong> to denote a <i>Sender Feature</i>.</td>
          </tr>
          <tr>
            <td valign="top">Sender <code>oneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Ed25519 Address</summary>
                <blockquote>An Address derived from an Ed25519 Public Key. Defined in <a href='../TIP-0038/tip-0038.md#ed25519-address'>TIP-38 (Ed25519 Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Account Address</summary>
                <blockquote>An Address derived from an Account ID which can be unlocked by unlocking the corresponding Account. Defined in <a href='../TIP-0038/tip-0038.md#account-address'>TIP-38 (Account Address)</a>.</blockquote>
              </details>
              <details>
                <summary>NFT Address</summary>
                <blockquote>An Address derived from an NFT ID which can be unlocked by unlocking the corresponding NFT. Defined in <a href='../TIP-0038/tip-0038.md#nft-address'>TIP-38 (NFT Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Anchor Address</summary>
                <blockquote>An Address derived from an Anchor ID which can be unlocked by unlocking the corresponding Anchor. Defined in <a href='../TIP-0038/tip-0038.md#anchor-address'>TIP-38 (Anchor Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Multi Address</summary>
                <blockquote>Defines a Multi Address that consists of addresses with weights and a threshold value. The Multi Address can be unlocked if the cumulative weight of all unlocked addresses is equal to or exceeds the threshold. Defined in <a href='../TIP-0052/tip-0052.md#multi-address'>TIP-52 (Multi Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Restricted Address</summary>
                <blockquote>An address that contains another address and allows for configuring its capabilities. Defined in <a href='../TIP-0050/tip-0050.md#restricted-address'>TIP-50 (Restricted Address)</a>.</blockquote>
              </details>
            </td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Metadata Feature</summary>
        <blockquote>Defines a map of key-value pairs that is stored in the output. Defined in <a href='../TIP-0038/tip-0038.md#metadata-feature'>TIP-38 (Metadata Feature)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Feature Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.</td>
          </tr>
          <tr>
            <td>Entries Count</td>
            <td>uint8</td>
            <td>The number of entries in the map.</td>
          </tr>
          <tr>
            <td valign="top">Entries <code>anyOf</code></td>
            <td colspan="2">
              <details>
                <summary>Metadata Entry</summary>
                <blockquote>A map entry consisting of a string key and an arbitrary byte value.</blockquote>
                <table>
                  <tr>
                    <td>
                      <b>Name</b>
                    </td>
                    <td>
                      <b>Type</b>
                    </td>
                    <td>
                      <b>Description</b>
                    </td>
                  </tr>
                  <tr>
                    <td>Key</td>
                    <td>(uint8)ByteArray</td>
                    <td>A string which may only consist of printable ASCII characters. A leading uint8 denotes its length.</td>
                  </tr>
                  <tr>
                    <td>Value</td>
                    <td>(uint16)ByteArray</td>
                    <td>An array of arbitrary binary data. A leading uint16 denotes its length.</td>
                  </tr>
                </table>
              </details>
            </td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Tag Feature</summary>
        <blockquote>Defines an indexation tag to which the output can be indexed by additional node plugins. Defined in <a href='../TIP-0038/tip-0038.md#tag-feature'>TIP-38 (Tag Feature)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Feature Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 4</strong> to denote a <i>Tag Feature</i>.</td>
          </tr>
          <tr>
            <td>Tag</td>
            <td>(uint8)ByteArray</td>
            <td>Binary indexation data. A leading uint8 denotes its length.</td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
  <tr>
    <td>Immutable Features Count</td>
    <td>uint8</td>
    <td>The number of immutable features following. Immutable features are defined upon deployment of the UTXO state machine and are not allowed to change in any future state transition.</td>
  </tr>
  <tr>
    <td valign="top">Immutable Features <code>atMostOneOfEach</code></td>
    <td colspan="2">
      <details>
        <summary>Issuer Feature</summary>
        <blockquote>Identifies the validated issuer of the UTXO state machine. Defined in <a href='../TIP-0038/tip-0038.md#issuer-feature'>TIP-38 (Issuer Feature)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Feature Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 1</strong> to denote a <i>Issuer Feature</i>.</td>
          </tr>
          <tr>
            <td valign="top">Issuer <code>oneOf</code></td>
            <td colspan="2">
              <details>
                <summary>Ed25519 Address</summary>
                <blockquote>An Address derived from an Ed25519 Public Key. Defined in <a href='../TIP-0038/tip-0038.md#ed25519-address'>TIP-38 (Ed25519 Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Account Address</summary>
                <blockquote>An Address derived from an Account ID which can be unlocked by unlocking the corresponding Account. Defined in <a href='../TIP-0038/tip-0038.md#account-address'>TIP-38 (Account Address)</a>.</blockquote>
              </details>
              <details>
                <summary>NFT Address</summary>
                <blockquote>An Address derived from an NFT ID which can be unlocked by unlocking the corresponding NFT. Defined in <a href='../TIP-0038/tip-0038.md#nft-address'>TIP-38 (NFT Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Anchor Address</summary>
                <blockquote>An Address derived from an Anchor ID which can be unlocked by unlocking the corresponding Anchor. Defined in <a href='../TIP-0038/tip-0038.md#anchor-address'>TIP-38 (Anchor Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Multi Address</summary>
                <blockquote>Defines a Multi Address that consists of addresses with weights and a threshold value. The Multi Address can be unlocked if the cumulative weight of all unlocked addresses is equal to or exceeds the threshold. Defined in <a href='../TIP-0052/tip-0052.md#multi-address'>TIP-52 (Multi Address)</a>.</blockquote>
              </details>
              <details>
                <summary>Restricted Address</summary>
                <blockquote>An address that contains another address and allows for configuring its capabilities. Defined in <a href='../TIP-0050/tip-0050.md#restricted-address'>TIP-50 (Restricted Address)</a>.</blockquote>
              </details>
            </td>
          </tr>
        </table>
      </details>
      <details>
        <summary>Metadata Feature</summary>
        <blockquote>Defines a map of key-value pairs that is stored in the output. Defined in <a href='../TIP-0038/tip-0038.md#metadata-feature'>TIP-38 (Metadata Feature)</a>.</blockquote>
        <table>
          <tr>
            <td>
              <b>Name</b>
            </td>
            <td>
              <b>Type</b>
            </td>
            <td>
              <b>Description</b>
            </td>
          </tr>
          <tr>
            <td>Feature Type</td>
            <td>uint8</td>
            <td>Set to <strong>value 2</strong> to denote a <i>Metadata Feature</i>.</td>
          </tr>
          <tr>
            <td>Entries Count</td>
            <td>uint8</td>
            <td>The number of entries in the map.</td>
          </tr>
          <tr>
            <td valign="top">Entries <code>anyOf</code></td>
            <td colspan="2">
              <details>
                <summary>Metadata Entry</summary>
                <blockquote>A map entry consisting of a string key and an arbitrary byte value.</blockquote>
                <table>
                  <tr>
                    <td>
                      <b>Name</b>
                    </td>
                    <td>
                      <b>Type</b>
                    </td>
                    <td>
                      <b>Description</b>
                    </td>
                  </tr>
                  <tr>
                    <td>Key</td>
                    <td>(uint8)ByteArray</td>
                    <td>A string which may only consist of printable ASCII characters. A leading uint8 denotes its length.</td>
                  </tr>
                  <tr>
                    <td>Value</td>
                    <td>(uint16)ByteArray</td>
                    <td>An array of arbitrary binary data. A leading uint16 denotes its length.</td>
                  </tr>
                </table>
              </details>
            </td>
          </tr>
        </table>
      </details>
    </td>
  </tr>
</table>

## Additional Transaction Syntactic Validation Rules

### Output Syntactic Validation

- It must hold true that `1` ≤ `Unlock Conditions Count` ≤ `4`.
- `Unlock Condition Type` of an <i>Unlock Condition</i> must define one of the following types:
  - <i>Address Unlock Condition</i>
  - <i>Storage Deposit Return Unlock Condition</i>
  - <i>Timelock Unlock Condition</i>
  - <i>Expiration Unlock Condition</i>
- <i>Unlock Conditions</i> must be sorted in ascending order based on their `Unlock Condition Type`.
- Syntactic validation of all present unlock conditions must pass.
- <i>Address Unlock Condition</i> must be present.
- It must hold true that `0` ≤ `Features Count` ≤ `3`.
- `Feature Type` of a <i>Feature</i> in `Features` must define one of the following types:
  - <i>Sender Feature</i>
  - <i>Metadata Feature</i>
  - <i>Tag Feature</i>
- It must hold true that `0` ≤ `Immutable Features Count` ≤ `2`.
- `Feature Type` of a <i>Feature</i> in `Immutable Features` must define one of the following types:
  - <i>Issuer Feature</i>
  - <i>Metadata Feature</i>
- <i>Features</i> must be sorted in ascending order based on their `Feature Type` both in `Features` and
  `Immutable Features` fields.
- Syntactic validation of all present features must pass.
- `Address` field of the <i>Address Unlock Condition</i> must not be the same as the NFT address derived from `NFT ID`.

## Additional Transaction Semantic Validation Rules

- Explicit `NFT ID`: `NFT ID` is taken as the value of the `NFT ID` field in the NFT output.
- Implicit `NFT ID`: When an NFT output is consumed as an input in a transaction and `NFT ID` field is zeroed out, take
  the BLAKE2b-256 hash of the `Output ID` of the input as `NFT ID`.
- For every non-zero explicit `NFT ID` on the output side there must be a corresponding NFT on the input side. The
  corresponding NFT has the explicit or implicit `NFT ID` equal to that of the NFT on the output side.

### Consumed Outputs

- The unlock of the input corresponds to `Address` field of the <i>Address Unlock Condition</i> and the unlock is valid.
- The unlock is valid if and only if all unlock conditions and features present in the output validate.
- When a consumed NFT output has a corresponding NFT output on the output side, `Immutable Features` field must not
  change.
- When a consumed NFT output has no corresponding NFT output on the output side, the NFT is being burned. Funds and
  assets inside the burned NFT output must be redistributed to other outputs in the burning transaction.
  - The transaction is invalid if an NFT is burned and the _Can destroy NFT Outputs_ flag in the _Transaction
    Capabilities_ is **unset**.

| :bangbang: Careful with NFT burning :bangbang: |
| ---------------------------------------------- |

_Other outputs in the ledger that are locked to the address of the NFT can only be unlocked by including the NFT itself
in the transaction. If the NFT is burned, such funds are locked forever. It is strongly advised to always check and
sweep what the NFT owns in the ledger before burning it._

### Created Outputs

- When `Issuer Feature` is present in an output and explicit `NFT ID` is zeroed out, an input with `Address` field that
  corresponds to `Issuer` must be unlocked in the transaction. If `Address` is either <i>Account Address</i> or <i>NFT
  Address</i>, their corresponding outputs (defined by `Account ID` and `NFT ID`) must be unlocked in the transaction.
- All <i>Unlock Condition</i> imposed transaction validation criteria must be fulfilled.
- All <i>Feature</i> imposed transaction validation criteria must be fulfilled.

## NFT Locking & Unlocking

The `NFT ID` field is functionally equivalent to `Account ID` of an account output. It is generated the same way, but it
can only exist in NFT outputs. Following the same analogy as for account addresses, NFT addresses are iota addresses
that are controlled by whoever owns the NFT output itself.

Outputs that are locked under `NFT Address` can be unlocked by unlocking the NFT output in the same transaction that
defines `NFT Address`, that is, the NFT output where `NFT Address Type Byte || NFT ID = NFT Address`.

An <i>NFT Unlock</i> looks and behaves like an <i>Account Unlock</i>, but the referenced input at the index must be an
NFT output with the matching `NFT ID`.

<details>
  <summary>NFT Unlock</summary>
  <blockquote>Points to the unlock of a consumed NFT Output.</blockquote>
</details>
<table>
  <tr>
    <td>
      <b>Name</b>
    </td>
    <td>
      <b>Type</b>
    </td>
    <td>
      <b>Description</b>
    </td>
  </tr>
  <tr>
    <td>Unlock Type</td>
    <td>uint8</td>
    <td>Set to <strong>value 4</strong> to denote an <i>NFT Unlock</i>.</td>
  </tr>
  <tr>
    <td>NFT Reference Unlock Index</td>
    <td>uint16</td>
    <td>Index of input and unlock corresponding to an NFT Output.</td>
  </tr>
</table>

An _NFT Unlock_ is only valid if the input in the transaction at index `NFT Reference Unlock Index` is the NFT output
with the same `NFT ID` as the one derived from the `Address` field of the to-be unlocked output.

If the i-th _Unlock_ of a transaction is an _NFT Unlock_ and has `NFT Reference Unlock Index` set to k, it must hold
that i > k. Hence, an <i>NFT Unlock</i> can only reference an _Unlock_ at a smaller index.

### NFT Unlock Syntactic Validation

- It must hold that 0 ≤ `NFT Reference Unlock Index` < `Max Inputs Count - 1`.

### NFT Unlock Semantic Validation

- The address of the input being unlocked must be an <i>NFT Address</i>.
- The index `i` of the <i>NFT Unlock</i> is the index of the input in the transaction that it unlocks.
  `NFT Reference Unlock Index` must be < `i`.
- `NFT Reference Unlock Index` defines a previous input of the transaction and its unlock. This input must be an <i>NFT
  Output</i> with `NFT ID` that refers to the <i>NFT Address</i> being unlocked.

# Test Vectors

The protocol parameters used in the following test vectors are the same as in
[TIP-49 (Protocol Parameters Hash)](../TIP-0049/tip-0049.md#protocol-parameters-hash).

## Storage Score

The following test vector shows the calculation of the storage score according to [TIP-47](../TIP-0047/tip-0047.md).

NFT Output (json-encoded):

```json
{
  "type": 4,
  "amount": "421000000",
  "mana": "0",
  "nftId": "0x3163482ff326658dd1bfead468a609bc6b3e74cb2e5094e0da9b63eae7e0166c",
  "unlockConditions": [
    {
      "type": 0,
      "address": {
        "type": 8,
        "accountId": "0x17432c5a7a672503480241125e3952414a7a320441080c624c264b004e09614a"
      }
    },
    {
      "type": 1,
      "returnAddress": {
        "type": 0,
        "pubKeyHash": "0xed1484f4d1f7d8c037087fed661dd92faccae1eed3c01182d6fdd6828cea144a"
      },
      "amount": "4000000"
    }
  ],
  "features": [
    {
      "type": 2,
      "entries": {
        "iota": "0x322e30"
      }
    }
  ],
  "immutableFeatures": [
    {
      "type": 2,
      "entries": {
        "nft": "0x696f7461"
      }
    }
  ]
}
```

NFT Output (hex-encoded binary serialization):

```
0x0440f317190000000000000000000000003163482ff326658dd1bfead468a609bc6b3e74cb2e5094e0da9b63eae7e0166c02000817432c5a7a672503480241125e3952414a7a320441080c624c264b004e09614a0100ed1484f4d1f7d8c037087fed661dd92faccae1eed3c01182d6fdd6828cea144a00093d000000000001020104696f74610300322e30010201036e66740400696f7461
```

NFT Output Storage Score: `240`.

# Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
